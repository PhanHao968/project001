{{!-- --}}
<div class="px-4 md:px-10 mx-auto w-full -m-24">
  <div class="flex flex-wrap mt-4">
    <div class="w-full mb-12 px-4 py-12">
      <div class="relative flex flex-col min-w-0 break-words w-full mb-6 shadow-lg rounded bg-white">
        <div class="rounded-t mb-0 px-4 py-3 border-0">
          <div class="flex flex-wrap items-center">
            <div class="relative w-full px-4 max-w-full flex-grow flex-1">
              <h3 class="font-semibold text-lg text-blueGray-700">
                Danh Sách Users
              </h3>
            </div>
          </div>
        </div>
        <div class="block w-full overflow-x-auto">
          <!-- Projects table -->
          <table class="items-center w-full bg-transparent border-collapse">
            <thead>
              <tr>
                <th
                  class="px-2 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-blueGray-50 text-blueGray-500 border-blueGray-100">
                  stt
                </th>
                <th
                  class="px-6 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-blueGray-50 text-blueGray-500 border-blueGray-100">
                  Email
                  <a href="{{../sortUrl}}?field=name&order={{../sortOrder}}" class="text-indigo-600">{{{email}}}</a>
                </th>
                </th>
                <th
                  class="px-2 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-blueGray-50 text-blueGray-500 border-blueGray-100">
                  Name
                  <a href="{{../sortUrl}}?field=name&order={{../sortOrder}}" class="text-indigo-600">{{{name}}}</a>
                </th>

                </th>
                <th
                  class="px-2 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-blueGray-50 text-blueGray-500 border-blueGray-100">
                  Date created
                  <a href="{{../sortUrl}}?field=name&order={{../sortOrder}}" class="text-indigo-600">{{{createdAt}}}</a>
                </th>
                <th
                  class="px-2 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-blueGray-50 text-blueGray-500 border-blueGray-100">
                  Date Update
                  <a href="{{../sortUrl}}?field=name&order={{../sortOrder}}" class="text-indigo-600">{{{updateAt}}}</a>
                </th>

                <th
                  class="px-2 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-blueGray-50 text-blueGray-500 border-blueGray-100">
                  Verify
                  <a href="{{../sortUrl}}?field=name&order={{../sortOrder}}" class="text-indigo-600">{{{updateAt}}}</a>
                </th>

                <th
                  class="px-6 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-blueGray-50 text-blueGray-500 border-blueGray-100">
                </th>
              </tr>
            </thead>
            <tbody>
              {{#each users}}
              <tr>
                <td class="border-t-0 px-2 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4">
                  {{sum @index 1}}
                </td>
                <th
                  class="border-t-0 px-2 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left flex items-center">
                  <span class="ml-3 font-bold text-blueGray-600">
                    {{this.email}}
                  </span>
                </th>
                <td class="border-t-0 px-2 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4">
                  {{this.name}}
                </td>
                <td class="border-t-0 px-2 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4">
                  <i class="fas fa-circle text-orange-500 mr-2"></i>
                  {{this.createdAt}}
                </td>
                <td class="border-t-0 px-2 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4">
                  <i class="fas fa-circle text-orange-500 mr-2"></i>
                  {{this.updatedAt}}
                </td>
                <td class="border-t-0 px-2 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4">
                  <i class="fas fa-circle text-orange-500 mr-2"></i>
                  {{this.isApproved}}
                </td>

                <td class="border-t-0 px-2 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4">
                  <input type="checkbox" id="approvalCheckbox{{@index}}"           
                    onclick="updateApproval('{{this._id}}', {{this.isApproved}})" {{#if this.isApproved}}checked{{/if}}>
                </td>

                <td class="border-t-0 px-2 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-right">
                  <a href="#pablo" class="text-blueGray-500 block py-1 px-3 hover:text-pink-600"
                    onclick="openDropdown(event,'table-light-1-dropdown-{{@index}}','{{this._id}}')">
                    <i class="fas fa-ellipsis-v"></i>
                  </a>

                  <div class="hidden bg-white text-base z-50 float-left py-2 list-none text-left rounded shadow-lg"
                    id="table-light-1-dropdown-{{@index}}">

                    <a href="/user/{{this._id}}/userEdit"
                      class="text-sm py-2 px-4 font-normal block w-full whitespace-nowrap bg-transparent text-blueGray-700 hover:text-pink-600">
                      Edit User
                    </a>

                    <a href="/setting/{{this._id}}/editprofile"
                      class="text-sm py-2 px-4 font-normal block w-full whitespace-nowrap bg-transparent text-blueGray-700 hover:text-pink-600">
                      Edit Profile
                    </a>

                    <button id="deleteButton" type="button" onclick="showModal('{{this._id}}')"
                      data-item-id="{{this._id}}"
                      class="text-sm py-2 px-4 font-normal block w-full whitespace-nowrap bg-transparent text-blueGray-700 hover:text-pink-600">
                      Delete</a>
                    </button>
                </td>

              </tr>

              {{/each}}
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

</div>
{{!-- --}}
</div>
{{!-- confirm delete --}}

<div id="delete-modal" class="relative z-10 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
  <div class="fixed inset-0 z-10 overflow-y-auto">
    <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
      <div
        class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
        <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
          <div class="sm:flex sm:items-start">
            <div
              class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
              <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
              </svg>
            </div>
            <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
              <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Xác nhận hành động</h3>
              <div class="mt-2">
                <p class="text-sm text-gray-500">Bạn có muốn xác nhận xoá không?</p>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
          <button type="button" id="deleteButton" onclick="deleteItem()"
            class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto">Delete</button>
          <button onclick="closeModal()" type="button"
            class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<form id="delete-user-form" method="POST"></form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>

  var itemId;


// Show modal delete
function showModal(id) {
  document.getElementById('delete-modal').classList.remove('hidden');
  itemId = id; // set id for itemId variable
}

// deleteItem will be execute after button Delete onclick
function deleteItem() {
  const deleteForm = document.getElementById("delete-user-form"); // Get element form
  deleteForm.action = `/user/${itemId}?_method=DELETE` // form get action along with itemId set before
  deleteForm.submit(); // form get submit
  closeModal();
}

function closeModal() {
  document.getElementById('delete-modal').classList.add('hidden');
}


document.addEventListener('click', (event) => {
  if (event.target.closest('#delete-modal')) // true
    document.getElementById('delete-modal').classList.add('hidden')
});

  //checked verify
  var userId;
  function updateApproval(userId, isChecked) {
    fetch(`/user/${userId}/approval`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ isApproved: !isChecked }),
    })
      .then((res) => {
        window.location.reload(true);
      })
      .catch(error => {
        window.alert(error)
      });
  }

</script>